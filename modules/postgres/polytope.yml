tools:
  postgres:
    info: "Runs PostgreSQL database"
    run:
      - tool: polytope/container
        args:
          image: postgres:15-alpine
          id: postgres
          restart:
            policy: always
          services:
            - id: postgres
              ports:
                - {
                    label: postgres,
                    protocol: tcp,
                    port: 5432,
                    expose-as: 5432,
                  }
          env:
            - { name: POSTGRES_USER, value: postgres }
            - { name: POSTGRES_PASSWORD, value: password }
            - { name: POSTGRES_DB, value: flowmentor }
            - { name: PGDATA, value: /var/lib/postgresql/data/pgdata }
          mounts:
            - path: /var/lib/postgresql/data
              source: { type: volume, scope: project, id: postgres-data }
          create: when-missing
